<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
	<title>Junge Liberale | Content Generator</title>
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport'><!--     Fonts and icons     -->
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet"><!-- CSS Files -->
	<link href="./assets/css/bootstrap.min.css" rel="stylesheet">
	<link href="./assets/css/now-ui-kit.css?v=1.1.0" rel="stylesheet">
	
  
	<style>
            html, body {
                height: 100%;
            }

            html {
                display: table;
                margin: auto;
            }

            body {
                display: table-cell;
                vertical-align: middle;
            }
	        @font-face {
	          font-family: "Montserrat-Regular";
	          src: url("./assets/fonts/Montserrat-Regular.otf");
	        }
	        
            .btn-text{
                font-family: "Montserrat-Regular", Arial, sans-serif;
                color: #e5007d;
            }
	        .mag-text {
	          font-family: "Montserrat-Regular", Arial, sans-serif;
	          color: #e5007d;
	        }
	        
	        .blue-button{
	          background-color: #009ee3;
	        }
	        
	        .blue-button:hover{
	          background-color: #009ea3;
	        }
	        
	        .attention{
              padding: 5px; 
	        }
      
            .no-margin-padding{
              margin: 0!important; 
              padding: 0!important;
            }
      
            .shadow {
              box-shadow: 0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12);
              transition: box-shadow 0.28s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .shadow:hover {
              box-shadow: 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);
            }
	        
	</style>
</head>
<body style="background-color: #ffed00; margin-bottom: 200px">
    <button id = "go" class="btn btn-primary btn-lg btn-icon btn-round" style="position: fixed; bottom: 2vh; right: 2vw; z-index: 999">
        <i class="fa fa-edit"></i>
    </button>
	<div class="page-header" id="init">
		<div class="container">
			<div class="col-md-4 content-center">
				<div class="card card-login card-plain">
					<form action="" class="form" method="">
						<div class="header header-primary text-center"><img alt="" class="img-fluid" src="./assets/img/Logo-Junge-Liberale-web.png"></div><br>
						<div class="content">
							<h5 class="mag-text"><b>Content Generator</b></h5>
							<p class="mag-text"><b>Please Scroll-down to get started.</b></p>
						</div>
                        <!--
						<div class="footer text-center" id="hide-btn">
							<a class="btn btn-info btn-lg"><b>Get Started</b></a>
						</div>
-                       -->
					</form>
				</div>
			</div>
		</div>
	</div>

    <div id="editor" class="container-fluid no-margin-padding">
      <div class="row no-gutters justify-content-center">
        <div class = "col-12">
            <div class="container-fluid no-margin-padding">
               <div class="row no-gutters">
                  <div class="col-12">
                    <img alt="" id = "logo" class="img-fluid" src="./assets/img/Logo-Junge-Liberale-web.png" style="height: 10vh; display: none">
                  </div> 
               </div>
               <div class="row no-gutters">
                  <canvas id="visible" class="col-12 no-margin-padding"></canvas>
               </div>

            </div>

            <div class="container-fluid no-margin-padding" >
                <div class="row no-gutters">
                    <div class="col-12">
                        <button class="btn btn-sm btn-info float-left" id="reset" type="button"><i class="fa fa-refresh"></i> Reset</button> 
                      
                        <button class="btn btn-sm btn-info float-right" id="upload" type="button"><i class="fa fa-upload"></i> Upload Image</button> <input class="form-control" id="imgLoader" placeholder="Default" style="display: none" type="file">
                    </div>
                </div>
            </div><br>
            <div id = "scroll-here" class="container">
                <div class="row">
                    <div class="col-12 mag-text">
                        Add Frame
                    </div>
                </div>
                <div class="row">
                    <div class="frame-div col-6 attention"><img alt="" class="img-fluid shadow" src="./assets/img/Vorlage%20Rahmen.png"></div>
                    <div class="frame-div col-6 attention"><img alt="" class="img-fluid shadow" src="./assets/img/Vorlage%201.png"></div>
                </div>
                <div class="row">
                    <div class="frame-div col-6 attention"><img alt="" class="img-fluid shadow" src="./assets/img/Vorlage%202.png"></div>
                </div>
            </div><br>
            <div class="container">
                <div class="row">
                    <div class="col-12 mag-text">
                        Add Banner
                    </div>
                </div>
                <div class="row">
                    <div class="banner-div col-6 attention" style="background-color: white"><img alt="" class="img-fluid shadow" src="./assets/img/Text%20Balken%20Hintergrund%204.png"></div>
                    <div class="banner-div col-6 attention"><img alt="" class="img-fluid shadow" src="./assets/img/Text%20Balken%20Hintergrund.png"></div>
                </div>
                <div class="row">
                    <div class="banner-div col-6 attention"><img alt="" class="img-fluid shadow" src="./assets/img/stammtisch.png"></div>    
                </div>
            </div><br>
            <div class="container">
                <div class="row">
                    <div class="col mag-text">
                        Add Text
                    </div>
                </div>
                <div class="row">
                    <div class = "col-12">
                        Please choose color <input type="color" value="#ffffff">
                    </div>
                </div>
                <div class="row" style="padding: 10px"> 
                    <div class = "col-12">
                      <input id="slogan-text" class="form-control" placeholder="" style="border: 0px solid white; border-radius: 0px; border-bottom: 2px solid #009ee3" type="text"> 
                    </div>
                </div>
                <div class="row"> 
                    <div class = "col-12">
                      <button class="btn btn-info float-left" id="slogan-add"> Add </button>
                    </div>
                </div>
            </div><br>
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center">
                        <button class="btn btn-info" id="download-button"><i class="fa fa-download"></i>Download Image</button>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  
	<script src="./assets/js/core/jquery.3.2.1.min.js" type="text/javascript">
	</script> 
	<script src="./assets/js/core/popper.min.js" type="text/javascript">
	</script> 
	<script src="./assets/js/core/bootstrap.min.js" type="text/javascript">
	</script> <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
	 
	<script src="./assets/js/plugins/bootstrap-switch.js">
	</script> <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
	 
	<script src="./assets/js/plugins/nouislider.min.js" type="text/javascript">
	</script> <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
	 
	<script src="./assets/js/plugins/bootstrap-datepicker.js" type="text/javascript">
	</script> <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
	 
	<script src="./assets/js/now-ui-kit.js?v=1.1.0" type="text/javascript">
	</script> <!--  Fabric Js -->
	 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.7.20/fabric.min.js" type="text/javascript">
	</script> 
	<script>
	    
	    var back_image_src = "./assets/img/nophoto.jpg", frame_src = null, banner_src = null, slogan_text = null, text_color = '#ffffff';
	    var canvas = new fabric.Canvas('visible',  { preserveObjectStacking: true });
	    var disableScroll = function(){
          canvas.allowTouchScrolling = false;
        };

        var enableScroll = function(){
          canvas.allowTouchScrolling = true;
        };
      
	    function render(cur_canvas){
	        canvas.clear();
	        var back_image = new Image();
	          back_image.src = back_image_src;
	          back_image.onload = function(){
	            var background = new fabric.Image(back_image);
	            var scale_back = canvas.width / background.width;
	            background.width = canvas.width;
	            background.height = background.height * scale_back;
	            canvas.setHeight(background.height);
	            
	            background.set({
	              top : 0,
	              left : 0,
	              lockMovementX : true,
	              lockMovementY : true,
	              lockScalingX : true,
	              lockScalingY : true,
	              lockMovementX : true,
	              lockRotation : true,
	            });
	            canvas.add(background);
	            canvas.bringToFront(background);
	      
	            if(frame_src != null){
	              var fr_image = new Image();
	              fr_image.src = frame_src;
	              fr_image.onload = function(){
	                var frame = new fabric.Image(fr_image);
	                frame.set({
	                  height : canvas.height,
	                  width : canvas.width,
	                  top : 0,
	                  left : 0,
	                  lockMovementX : true,
	                  lockMovementY : true,
	                  lockScalingX : true,
	                  lockScalingY : true,
	                  lockMovementX : true,
	                  lockRotation : true,
	                });
	                canvas.add(frame);
	                canvas.bringToFront(frame);
	                if(banner_src != null){
	                  var bn_image = new Image();
	                  bn_image.src = banner_src;
	                  bn_image.onload = function(){
	                    var banner = new fabric.Image(bn_image);
	                    var scale_banner = (canvas.width - 200) / bn_image.width;
	                    banner.set({
	                      height : bn_image.height * scale_banner,
	                      width : bn_image.width * scale_banner,
	                      top : 100,
	                      left : 100,
	                    });
	                    canvas.add(banner);
	                    canvas.bringToFront(banner);
	                    if(slogan_text != null){
	                      var text = new fabric.Text(slogan_text, { left: 120, top: 120, fill: text_color, fontFamily: "Montserrat-Regular", fontWeight: 'bold'});
	                      canvas.add(text); 
	                      canvas.bringToFront(text);
	                    }
	                  }
	                }
	              }
	            }
	            else if(banner_src != null){
	                var bn_image = new Image();
	                bn_image.src = banner_src;
	                bn_image.onload = function(){
	                  var banner = new fabric.Image(bn_image);
	                  var scale_banner = (canvas.width - 200) / bn_image.width;
	                  banner.set({
	                    height : bn_image.height * scale_banner,
	                    width : bn_image.width * scale_banner,
	                    top : 100,
	                    left : 100,
	                  });
	                  canvas.add(banner);
	                  canvas.bringToFront(banner);
	                  if(slogan_text != null){
	                    var text = new fabric.Text(slogan_text, { left: 120, top: 120, fill: text_color, fontFamily: "Montserrat-Regular", fontWeight: 'bold'});
	                    canvas.add(text); 
	                    canvas.bringToFront(text);
	                  }
	                }
	              }
	            else if(slogan_text != null){
	                var text = new fabric.Text(slogan_text, { left: 120, top: 120, fill: text_color, fontFamily: "Montserrat-Regular", fontWeight: 'bold'});
	                canvas.add(text); 
	                canvas.bringToFront(text);
	              }
	          }
	     }

	      $(function(){
	        render(canvas);
            canvas.setWidth($('#editor').width());
            setTimeout(function(){ $('#init').fadeOut('slow'); $('#logo').fadeIn('slow') }, 5000);
	      })
	    
	      document.getElementById('imgLoader').onchange = function handleImage(e) {
	        var reader = new FileReader();
	        reader.onload = function (event) {
	            back_image_src = event.target.result;
	            render(canvas);
	        }
	        reader.readAsDataURL(e.target.files[0]);
	      };
          $("#reset").on('click', function(){
	        back_image_src = "./assets/img/nophoto.jpg", frame_src = null, banner_src = null, slogan_text = null, text_color = '#ffffff';
            render(canvas);
	      });
      
      
	      $('#upload').on('click', function(){
	        $('#imgLoader').click();
	      });
	    
	      $('.frame-div').on('click', function(){
	        frame_src = $(this).find('img').attr('src');
	        render(canvas);
	      });
	    
	      $('.banner-div').on('click', function(){
	        banner_src = $(this).find('img').attr('src');
	        render(canvas);
	      });
	    
	      $('input[type="color"]').on('change', function(){
	        text_color = $(this).val();
	      });
	    
	      $('#slogan-add').on('click', function(){
	        slogan_text = $('#slogan-text').val();
	        $('#slogan-text').val('');
	        render(canvas);
	      });
	      
          function dataURLtoBlob(dataurl) {
              var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
                  bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
              while(n--){
                  u8arr[n] = bstr.charCodeAt(n);
              }
              return new Blob([u8arr], {type:mime});
          }
          var downloadCanvas = function(){
                var link = document.createElement("a");
                var imgData = canvas.toDataURL({format: 'png', multiplier: 4});
                var strDataURI = imgData.substr(22, imgData.length);
                var blob = dataURLtoBlob(imgData);
                var objurl = URL.createObjectURL(blob);
                link.download = "Junge-Liberale-"+ new Date().getTime() + ".png";
                link.href = objurl;
                link.click();``
            } 
          
	      $("#download-button").on('click', function(){
	        canvas.deactivateAll().renderAll();
            downloadCanvas();
	      });
          $("#go").click(function() {
              $('html,body').animate({
                  scrollTop: $("#scroll-here").offset().top},
                  'slow');
          });
	</script>
</body>
</html>